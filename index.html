<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lite Portföy Terminali – Final</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#030508;color:#fff;margin:0;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    .card{background:#0f1420;border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:14px}
    .label{font-size:11px;color:#94a3b8;text-transform:uppercase;font-weight:700}
    .value{font-size:20px;font-weight:800;margin-top:4px}
    .up{color:#22c55e}.down{color:#ef4444}
    .title{font-weight:900;font-size:18px;margin-bottom:12px}
    .footer{margin-top:20px;font-size:11px;color:#94a3b8}
  </style>
</head>
<body>

<div class="title">Lite Portföy Terminali</div>

<div class="grid" id="macro"></div>

<div class="footer" id="info"></div>

<script>
/* ================= CONFIG ================= */
const PORTFOY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";   // portföy varlıkları
const DATA_CSV    = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=2136415211&single=true&output=csv";      // günlük portföy değerleri
const MACRO_CSV   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=1018386005&single=true&output=csv";     // usd, eur, enflasyon vs

/* ================= HELPERS ================= */
function clean(v){if(!v)return null;return parseFloat(String(v).replace(',','.'))}
function parseDate(d){const p=d.split('.');return new Date(p[2],p[1]-1,p[0])}
function fmt(n){return n.toLocaleString('tr-TR',{maximumFractionDigits:2})}

async function fetchCSV(url){
  const res=await fetch(url,{cache:'no-store'});
  const txt=await res.text();
  const [h,...r]=txt.trim().split('\n');
  const headers=h.split(',');
  return r.map(l=>{
    const o={};l.split(',').forEach((v,i)=>o[headers[i]]=v);return o;
  });
}

/* ================= MAIN ================= */
(async()=>{
  const macro=await fetchCSV(MACRO_CSV);
  const data =await fetchCSV(DATA_CSV);

  // ---- MACRO PANEL ----
  const targets={USDTRY:'USD/TL',EURTRY:'EUR/TL',ALTIN_GRAM:'Gram Altın',ENFLASYON_Y:'Enflasyon',MEVDUAT_Y:'Mevduat',BIST100:'BIST 100'};
  const html=Object.keys(targets).map(k=>{
    const row=macro.find(r=>r.KOD===k);
    if(!row)return '';
    const v=clean(row.DEGER);
    const isPct=k.includes('_Y');
    return `<div class="card"><div class="label">${targets[k]}</div><div class="value">${isPct?'%':''}${fmt(v)}</div></div>`;
  }).join('');
  document.getElementById('macro').innerHTML=html;

  // ---- PERFORMANCE ----
  const rows=data.map(r=>({d:parseDate(r.TARIH),v:clean(r.PORTFOY)})).sort((a,b)=>a.d-b.d);
  const first=rows[0],last=rows[rows.length-1];
  const ret=((last.v-first.v)/first.v*100);

  document.getElementById('info').textContent=
    `Başlangıç: ${first.d.toLocaleDateString('tr-TR')} | Güncel: ${last.d.toLocaleDateString('tr-TR')} | Toplam Getiri: %${ret.toFixed(2)}`;
})();
</script>
</body>
</html>
