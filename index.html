<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PortfÃ¶y Takibi Pro</title>
  <style>
    :root {
      --bg: #0f1117;
      --card: #1a1f2e;
      --text: #e2e8f0;
      --text-muted: #94a3b8;
      --border: #334155;
      --green: #22c55e;
      --red: #ef4444;
      --header: #111827;
      --accent: #3b82f6;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px 15px;
      min-height: 100vh;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    h2 {
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }

    /* Ã–zet KartlarÄ± */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .summary-card {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      text-align: center;
    }

    .summary-card span {
      display: block;
      color: var(--text-muted);
      font-size: 0.85rem;
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .summary-card div {
      font-size: 1.4rem;
      font-weight: bold;
    }

    /* Kontroller */
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      background: var(--card);
      padding: 10px 20px;
      border-radius: 10px;
    }

    select {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 8px 12px;
      border-radius: 6px;
      outline: none;
    }

    /* Tablo TasarÄ±mÄ± */
    .table-container {
      overflow-x: auto;
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    th {
      background: var(--header);
      padding: 15px;
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--text-muted);
      letter-spacing: 0.05em;
      text-align: right;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid var(--border);
      text-align: right;
    }

    th:first-child, td:first-child { text-align: left; padding-left: 25px; }
    th:nth-child(2), td:nth-child(2) { text-align: center; }

    .kar { color: var(--green); }
    .zarar { color: var(--red); }

    tr:hover { background: #20263a; }

    .no-data {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>ðŸ“Š PortfÃ¶y Takibi</h2>

    <div class="summary-grid">
      <div class="summary-card">
        <span>Toplam DeÄŸer</span>
        <div id="totalValue">0 â‚º</div>
      </div>
      <div class="summary-card">
        <span>Toplam Kar/Zarar</span>
        <div id="totalKZ">0 â‚º</div>
      </div>
    </div>

    <div class="controls">
      <label>VarlÄ±k TÃ¼rÃ¼:</label>
      <select id="turFilter">
        <option value="all">TÃ¼mÃ¼</option>
      </select>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>VarlÄ±k</th>
            <th>TÃ¼r</th>
            <th>Adet</th>
            <th>AlÄ±ÅŸ FiyatÄ±</th>
            <th>Tutar</th>
            <th>GÃ¼nlÃ¼k %</th>
            <th>Toplam K/Z</th>
          </tr>
        </thead>
        <tbody id="tablo"></tbody>
      </table>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
      const tbody = document.getElementById("tablo");
      const filterSelect = document.getElementById("turFilter");
      const totalValEl = document.getElementById("totalValue");
      const totalKZEl = document.getElementById("totalKZ");
      
      let allRows = [];

      function renderTable(filter = "all") {
        tbody.innerHTML = "";
        
        const filtered = filter === "all" 
          ? allRows 
          : allRows.filter(row => row.tur === filter);

        // Ã–zetleri gÃ¼ncelle
        const totalValue = filtered.reduce((sum, r) => sum + r.tutar, 0);
        const totalKZ = filtered.reduce((sum, r) => sum + r.kz, 0);
        
        totalValEl.textContent = totalValue.toLocaleString('tr-TR', {maximumFractionDigits:0}) + " â‚º";
        totalKZEl.textContent = totalKZ.toLocaleString('tr-TR', {maximumFractionDigits:0}) + " â‚º";
        totalKZEl.className = totalKZ >= 0 ? 'kar' : 'zarar';

        if (filtered.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="no-data">Veri bulunamadÄ±</td></tr>';
          return;
        }

        filtered.forEach(row => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><strong>${row.ad}</strong></td>
            <td><span style="font-size:0.85rem; opacity:0.8">${row.tur}</span></td>
            <td>${row.adet.toLocaleString('tr-TR')}</td>
            <td>${row.alisFiyati.toLocaleString('tr-TR', {minimumFractionDigits:2})}</td>
            <td>${row.tutar.toLocaleString('tr-TR')} â‚º</td>
            <td class="${row.gunluk >= 0 ? 'kar' : 'zarar'}">${row.gunlukText}</td>
            <td class="${row.kz >= 0 ? 'kar' : 'zarar'}">${row.kzText} â‚º</td>
          `;
          tbody.appendChild(tr);
        });
      }

      Papa.parse(csvUrl, {
        download: true,
        skipEmptyLines: true,
        complete: function(results) {
          const rows = results.data;

          const cleanNum = (val) => {
            if (!val || val.includes('#N/A')) return 0;
            // Binlik ayracÄ± olan noktayÄ± kaldÄ±r, ondalÄ±k virgÃ¼lÃ¼ noktaya Ã§evir
            let cleaned = val.toString().replace(/\./g, '').replace(',', '.').replace(/[^0-9.-]+/g, '');
            return parseFloat(cleaned) || 0;
          };

          allRows = rows.slice(2)
            .filter(row => row && row.length >= 9 && row[0]?.trim())
            .map(row => {
              const kz = cleanNum(row[6]);
              const gunluk = cleanNum(row[8]);
              
              return {
                ad: row[0]?.trim(),
                tur: row[1]?.trim(),
                adet: cleanNum(row[2]),
                alisFiyati: cleanNum(row[3]),
                tutar: cleanNum(row[5]),
                kz: kz,
                gunluk: gunluk,
                kzText: row[6]?.includes('#N/A') ? '#N/A' : kz.toLocaleString('tr-TR'),
                gunlukText: row[8]?.includes('#N/A') ? '-' : (gunluk > 0 ? '+' : '') + gunluk.toFixed(2) + '%'
              };
            });

          // Filtre doldur
          const turSet = [...new Set(allRows.map(r => r.tur))].sort();
          turSet.forEach(tur => {
            const opt = document.createElement("option");
            opt.value = opt.textContent = tur;
            filterSelect.appendChild(opt);
          });

          renderTable();
        }
      });

      filterSelect.addEventListener("change", (e) => renderTable(e.target.value));
    });
  </script>
</body>
</html>
