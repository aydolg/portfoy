<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KiÅŸisel PortfÃ¶y YÃ¶netimi</title>
  <style>
    :root {
      --bg: #0b0e14;
      --card: #151921;
      --text: #f0f2f5;
      --text-muted: #848e9c;
      --border: #2b2f36;
      --green: #0ecb81;
      --red: #f6465d;
      --accent: #f0b90b;
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
    }

    .container { max-width: 1300px; margin: 0 auto; }

    /* Ãœst Ã–zet KartlarÄ± */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .summary-card {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
    }

    .summary-card span { display: block; color: var(--text-muted); font-size: 0.8rem; font-weight: 600; text-transform: uppercase; margin-bottom: 8px; }
    .summary-card div { font-size: 1.6rem; font-weight: 700; font-variant-numeric: tabular-nums; }

    /* Filtre ve BaÅŸlÄ±k */
    .header-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    select {
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Tablo TasarÄ±mÄ± */
    .table-container {
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow-x: auto;
    }

    table { width: 100%; border-collapse: collapse; min-width: 1100px; }
    
    th {
      background: #1e2329;
      padding: 15px;
      text-align: right;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid var(--border);
      text-align: right;
      font-variant-numeric: tabular-nums;
      font-size: 0.9rem;
    }

    th:first-child, td:first-child { text-align: left; padding-left: 20px; }
    
    .varlik-info { display: flex; flex-direction: column; }
    .varlik-name { font-weight: 700; color: #fff; }
    .varlik-date { font-size: 0.7rem; color: var(--text-muted); }

    .kar { color: var(--green); }
    .zarar { color: var(--red); }
    .na-value { color: var(--text-muted); font-style: italic; }

    tr:hover { background: #1e2329; }
  </style>
</head>
<body>

  <div class="container">
    <div class="header-actions">
      <h2 style="margin:0">ðŸ“Š PortfÃ¶y Ä°zleme Paneli</h2>
      <select id="turFilter">
        <option value="all">TÃ¼m VarlÄ±k TÃ¼rleri</option>
      </select>
    </div>

    <div class="summary-grid">
      <div class="summary-card">
        <span>Toplam YatÄ±rÄ±m</span>
        <div id="totalInvestment">0 â‚º</div>
      </div>
      <div class="summary-card">
        <span>GÃ¼ncel DeÄŸer</span>
        <div id="currentValue">0 â‚º</div>
      </div>
      <div class="summary-card">
        <span>Toplam KÃ¢r/Zarar</span>
        <div id="totalProfit">0 â‚º</div>
      </div>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>VarlÄ±k / Tarih</th>
            <th>TÃ¼r</th>
            <th>Adet</th>
            <th>AlÄ±ÅŸ FiyatÄ±</th>
            <th>YatÄ±rÄ±m TutarÄ±</th>
            <th>GÃ¼ncel Fiyat</th>
            <th>GÃ¼ncel Tutar</th>
            <th>KÃ¢r / Zarar</th>
          </tr>
        </thead>
        <tbody id="tabloGÃ¶vde"></tbody>
      </table>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    // Sizin Google Sheets CSV URL'niz
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
    
    let tumVeriler = [];

    // SayÄ± Temizleme (TÃ¼rkÃ§e formatÄ± destekler: 1.250,50 -> 1250.50)
    function temizleSayi(deger) {
      if (!deger || deger.includes('#N/A')) return null;
      let temiz = deger.toString().replace(/\./g, '').replace(',', '.').replace(/[^0-9.-]+/g, '');
      return parseFloat(temiz) || 0;
    }

    function tabloyuCiz(filtre = "all") {
      const gÃ¶vde = document.getElementById("tabloGÃ¶vde");
      gÃ¶vde.innerHTML = "";
      
      const filtrelenmis = filtre === "all" ? tumVeriler : tumVeriler.filter(v => v.tur === filtre);

      let toplamYatirim = 0;
      let toplamGuncel = 0;
      let toplamKZ = 0;

      filtrelenmis.forEach(v => {
        toplamYatirim += (v.yatirimTutari || 0);
        toplamGuncel += (v.guncelTutar || 0);
        toplamKZ += (v.kz || 0);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>
            <div class="varlik-info">
              <span class="varlik-name">${v.ad}</span>
              <span class="varlik-date">${v.tarih}</span>
            </div>
          </td>
          <td><small>${v.tur}</small></td>
          <td>${v.adet ? v.adet.toLocaleString('tr-TR') : '-'}</td>
          <td>${v.alisFiyati ? v.alisFiyati.toLocaleString('tr-TR', {minimumFractionDigits:2}) + ' â‚º' : '-'}</td>
          <td>${v.yatirimTutari ? v.yatirimTutari.toLocaleString('tr-TR') + ' â‚º' : '-'}</td>
          <td style="font-weight:600">${v.guncelFiyat ? v.guncelFiyat.toLocaleString('tr-TR', {minimumFractionDigits:4}) : '<span class="na-value">Veri Yok</span>'}</td>
          <td style="font-weight:600">${v.guncelTutar ? v.guncelTutar.toLocaleString('tr-TR') + ' â‚º' : '-'}</td>
          <td class="${v.kz >= 0 ? 'kar' : 'zarar'}" style="font-weight:700">
            ${v.kz !== null ? v.kz.toLocaleString('tr-TR') + ' â‚º' : '-'}
          </td>
        `;
        gÃ¶vde.appendChild(tr);
      });

      // Ã–zet KartlarÄ±nÄ± GÃ¼ncelle
      document.getElementById("totalInvestment").textContent = toplamYatirim.toLocaleString('tr-TR') + " â‚º";
      document.getElementById("currentValue").textContent = toplamGuncel.toLocaleString('tr-TR') + " â‚º";
      document.getElementById("totalProfit").textContent = toplamKZ.toLocaleString('tr-TR') + " â‚º";
      document.getElementById("totalProfit").className = toplamKZ >= 0 ? 'kar' : 'zarar';
    }

    Papa.parse(csvUrl, {
      download: true,
      header: false,
      complete: function(results) {
        const satirlar = results.data.slice(1); // BaÅŸlÄ±ÄŸÄ± atla
        
        tumVeriler = satirlar
          .filter(s => s[0] && s[0].trim() !== "")
          .map(s => ({
            ad: s[0],
            tur: s[1],
            adet: temizleSayi(s[2]),
            alisFiyati: temizleSayi(s[3]),
            yatirimTutari: temizleSayi(s[4]),
            guncelFiyat: temizleSayi(s[5]),
            guncelTutar: temizleSayi(s[6]),
            kz: temizleSayi(s[7]),
            tarih: s[8] || ''
          }));

        // TÃ¼r Filtresini Doldur
        const turler = [...new Set(tumVeriler.map(v => v.tur))].sort();
        const select = document.getElementById("turFilter");
        turler.forEach(t => {
          const opt = document.createElement("option");
          opt.value = opt.textContent = t;
          select.appendChild(opt);
        });

        tabloyuCiz();
      }
    });

    document.getElementById("turFilter").addEventListener("change", (e) => tabloyuCiz(e.target.value));
  </script>
</body>
</html>
