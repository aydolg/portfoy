<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Ultimate PortfÃ¶y Terminali</title>
<style>
body{font-family:Inter,Arial;background:#0f1220;color:#eaeaf0;margin:0;padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
.card{background:#171a2b;border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
.big{font-size:26px;font-weight:700;margin-top:6px}
.muted{opacity:.7;font-size:13px}
.badge{display:inline-block;padding:4px 8px;border-radius:10px;font-size:12px;margin-top:6px}
.ok{background:#1d7f4e}
.warn{background:#8a6d1d}
.bad{background:#7f1d1d}
h2{margin:30px 0 10px}
</style>
</head>
<body>
<h1>ðŸ“Š Ultimate PortfÃ¶y Terminali</h1>
<div id="cards" class="grid"></div>

<script>
/* ================= CONFIG ================= */
const PORTFOY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
const DATA_CSV    = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=2136415211&single=true&output=csv";
const MACRO_CSV   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=1018386005&single=true&output=csv";

/* ================= UTILS ================= */
const norm = s => s.toString().toLowerCase().replace(/[^a-z0-9]/g,"");

async function loadCSV(url){
  const t = await fetch(url).then(r=>r.text());
  const lines = t.replace(/\r/g,"").trim().split("\n");
  const headers = lines.shift().split(",").map(norm);
  return lines.map(l=>{
    const o={};
    l.split(",").forEach((v,i)=>{
      o[headers[i]] = isNaN(v)?v:Number(v);
    });
    return o;
  });
}

/* ================= MAIN ================= */
(async()=>{
  const portRaw = await loadCSV(PORTFOY_CSV);
  const macroRaw = await loadCSV(MACRO_CSV);

  console.log("ðŸ“¦ PORTFÃ–Y:",portRaw);
  console.log("ðŸŒ MACRO:",macroRaw);

  const portfoy = portRaw.map(x=>({
    ad: x.ad || x.varlik || x.isim || "VarlÄ±k",
    yatirim: x.yatirim || x.maliyet || x.alis || 0,
    deger: x.tutar || x.deger || x.gunceldeger || 0
  }));

  const toplamYatirim = portfoy.reduce((s,x)=>s+x.yatirim,0);
  const toplamDeger   = portfoy.reduce((s,x)=>s+x.deger,0);
  const getiriPct = toplamYatirim ? ((toplamDeger-toplamYatirim)/toplamYatirim)*100 : 0;

  const enfObj = macroRaw.find(m=>norm(m.ad||"")==="enflasyon") || {};
  const enflasyon = enfObj.fiyat || enfObj.deger || 0;
  const reel = getiriPct - enflasyon;

  const badge = reel>0 ? "ok" : reel>-5 ? "warn" : "bad";

  document.getElementById("cards").innerHTML = `
    <div class="card"><div class="muted">Toplam YatÄ±rÄ±m</div><div class="big">${toplamYatirim.toLocaleString()} â‚º</div></div>
    <div class="card"><div class="muted">GÃ¼ncel DeÄŸer</div><div class="big">${toplamDeger.toLocaleString()} â‚º</div></div>
    <div class="card"><div class="muted">Nominal Getiri</div><div class="big">${getiriPct.toFixed(2)}%</div></div>
    <div class="card"><div class="muted">Reel Getiri</div><div class="big">${reel.toFixed(2)}%</div><span class="badge ${badge}">${badge.toUpperCase()}</span></div>
  `;
})();
</script>
</body>
</html>
