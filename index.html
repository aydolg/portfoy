<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portföy Analiz Paneli</title>
  <style>
    :root {
      --bg: #0b0e11;
      --card: #181a20;
      --header: #2b2f36;
      --text: #e2e8f0;
      --text-muted: #848e9c;
      --green: #0ecb81;
      --red: #f6465d;
      --accent: #f0b90b;
      --border: #2d3339;
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 15px;
    }

    .container { max-width: 1400px; margin: 0 auto; }

    /* Özet Kartlar */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      position: relative;
    }

    .card span { display: block; color: var(--text-muted); font-size: 0.75rem; font-weight: bold; text-transform: uppercase; margin-bottom: 8px; }
    .card div { font-size: 1.5rem; font-weight: 700; font-variant-numeric: tabular-nums; }

    /* Tablo Tasarımı */
    .table-container {
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow-x: auto;
    }

    table { width: 100%; border-collapse: collapse; min-width: 1100px; }
    
    th {
      background: var(--header);
      padding: 12px 15px;
      text-align: right;
      font-size: 0.7rem;
      color: var(--text-muted);
      white-space: nowrap;
    }

    td {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border);
      text-align: right;
      font-variant-numeric: tabular-nums;
      font-size: 0.85rem;
    }

    th:first-child, td:first-child { text-align: left; padding-left: 20px; }
    
    .symbol-box { display: flex; flex-direction: column; }
    .sym-name { font-weight: 600; color: #fff; }
    .sym-date { font-size: 0.7rem; color: var(--text-muted); }

    .up { color: var(--green); }
    .down { color: var(--red); }
    
    tr:hover { background: #222630; }

    select {
      background: var(--card); color: var(--text); border: 1px solid var(--border);
      padding: 8px 12px; border-radius: 8px; margin-bottom: 15px;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="summary-grid">
    <div class="card"><span>Toplam Yatırım</span><div id="totInv">0 ₺</div></div>
    <div class="card"><span>Güncel Portföy</span><div id="totCur">0 ₺</div></div>
    <div class="card"><span>Günlük K/Z</span><div id="totDaily">0 ₺</div></div>
    <div class="card"><span>Haftalık K/Z</span><div id="totWeekly">0 ₺</div></div>
    <div class="card"><span>Toplam K/Z</span><div id="totKZ">0 ₺</div></div>
  </div>

  <select id="filterType"><option value="all">Tüm Varlıklar</option></select>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Varlık / Tarih</th>
          <th>Tür</th>
          <th>Adet</th>
          <th>Alış</th>
          <th>Yatırım</th>
          <th>Fiyat</th>
          <th>Tutar</th>
          <th>Günlük K/Z</th>
          <th>Haftalık K/Z</th>
          <th>Toplam K/Z</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
  let allData = [];

  function clean(val) {
    if (!val || val === "" || val.includes('#N/A')) return 0;
    // Noktayı siler, virgülü noktaya çevirir (1.250,50 -> 1250.50)
    let num = val.toString().replace(/\./g, '').replace(',', '.').replace(/[^0-9.-]+/g, '');
    return parseFloat(num) || 0;
  }

  function updateDisplay(filter = "all") {
    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";
    const data = filter === "all" ? allData : allData.filter(d => d.tur === filter);

    let sums = { inv: 0, cur: 0, d: 0, w: 0, kz: 0 };

    data.forEach(item => {
      sums.inv += item.yatirim;
      sums.cur += item.tutar;
      sums.d += item.gunlukKZ;
      sums.w += item.haftalikKZ;
      sums.kz += item.toplamKZ;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><div class="symbol-box"><span class="sym-name">${item.ad}</span><span class="sym-date">${item.tarih}</span></div></td>
        <td><small>${item.tur}</small></td>
        <td>${item.adet.toLocaleString('tr-TR')}</td>
        <td>${item.alis.toLocaleString('tr-TR', {minimumFractionDigits:2})}</td>
        <td>${item.yatirim.toLocaleString('tr-TR')} ₺</td>
        <td style="font-weight:bold">${item.fiyat.toLocaleString('tr-TR', {minimumFractionDigits:2})}</td>
        <td style="font-weight:bold">${item.tutar.toLocaleString('tr-TR')} ₺</td>
        <td class="${item.gunlukKZ >= 0 ? 'up' : 'down'}">${item.gunlukKZ.toLocaleString('tr-TR')} ₺</td>
        <td class="${item.haftalikKZ >= 0 ? 'up' : 'down'}">${item.haftalikKZ.toLocaleString('tr-TR')} ₺</td>
        <td class="${item.toplamKZ >= 0 ? 'up' : 'down'}" style="font-weight:bold">${item.toplamKZ.toLocaleString('tr-TR')} ₺</td>
      `;
      tbody.appendChild(tr);
    });

    // Kartları Güncelle
    const setVal = (id, val, color = true) => {
      const el = document.getElementById(id);
      el.textContent = val.toLocaleString('tr-TR') + " ₺";
      if(color) el.className = val >= 0 ? 'up' : 'down';
    };

    setVal("totInv", sums.inv, false);
    setVal("totCur", sums.cur, false);
    setVal("totDaily", sums.d);
    setVal("totWeekly", sums.w);
    setVal("totKZ", sums.kz);
  }

  Papa.parse(csvUrl, {
    download: true,
    complete: function(res) {
      allData = res.data.slice(1) // Başlığı atla
        .filter(r => r[0] && r[0].trim() !== "")
        .map(r => ({
          ad: r[0],
          tur: r[1],
          tarih: r[2],
          adet: clean(r[3]),
          alis: clean(r[4]),
          yatirim: clean(r[5]),
          fiyat: clean(r[6]),
          tutar: clean(r[7]),
          gunlukKZ: clean(r[8]),
          haftalikKZ: clean(r[9]),
          toplamKZ: clean(r[10])
        }));

      // Filtre Listesi
      const types = [...new Set(allData.map(d => d.tur))].sort();
      const sel = document.getElementById("filterType");
      types.forEach(t => {
        const o = document.createElement("option");
        o.value = o.textContent = t;
        sel.appendChild(o);
      });

      updateDisplay();
    }
  });

  document.getElementById("filterType").addEventListener("change", (e) => updateDisplay(e.target.value));
</script>

</body>
</html>
