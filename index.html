<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Elite PortfÃ¶y Terminali v3.2</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#030508;--card-bg:rgba(16,20,29,.95);
--accent:#00ff9d;--red:#ff3b5c;
--text:#fff;--text-muted:#94a3b8;--border:rgba(255,255,255,.1);
}
body{font-family:'Plus Jakarta Sans';background:var(--bg);color:var(--text);margin:0;padding:12px}
.container{max-width:1200px;margin:auto}
.up{color:var(--accent)}.down{color:var(--red)}

.risk-badge{
background:var(--red);
color:#fff;
font-size:.5rem;
padding:2px 6px;
border-radius:6px;
margin-left:6px;
}
</style>
</head>

<body>
<div class="container">

<div class="perf-grid">
<div id="bestPerf" class="perf-box best"><div class="perf-label">GÃ¼nÃ¼n YÄ±ldÄ±zÄ±</div><div class="up">...</div></div>
<div id="worstPerf" class="perf-box worst"><div class="perf-label">GÃ¼nÃ¼n ZayÄ±fÄ±</div><div class="down">...</div></div>
</div>

<div class="summary-grid" id="summaryGrid"></div>

<!-- PORTFÃ–Y YORUMU -->
<div id="portfolioCommentBox" class="card" style="margin-bottom:15px">
<span>PortfÃ¶y Yorumu</span>
<div class="value" id="portfolioComment">â€“</div>
</div>

<div class="ticker-wrap">
<div class="ticker" id="tickerContent">Veriler senkronize ediliyor...</div>
</div>

<div class="chart-block">
<div class="market-header">VARLIK DAÄžILIMI (%)</div>
<div style="height:200px"><canvas id="allocationChart"></canvas></div>
</div>

<div class="market-block">
<div class="market-header">GÃœNCEL FÄ°YATLAR</div>
<div id="marketRows"></div>
</div>

<div id="detailSection" style="display:none;padding-bottom:100px">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
<div id="detailTitle" style="font-weight:800;color:var(--accent)">VARLIK ANALÄ°ZÄ°</div>
<div onclick="closeAll()" style="color:var(--red);cursor:pointer">[KAPAT]</div>
</div>
<div id="assetGrid"></div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
let globalData=[],allocationChart=null;

/* ===== CACHE ===== */
const saveCache=d=>localStorage.setItem("elite_cache",JSON.stringify(d));
const loadCache=()=>JSON.parse(localStorage.getItem("elite_cache")||"[]");

/* ===== HELPERS ===== */
function clean(v){
if(!v||v.toString().includes('#'))return 0;
return parseFloat(v.toString().replace(/\./g,'').replace(',','.'))||0;
}
function getDaysBetween(d){
try{let p=d.split('.');return Math.floor((Date.now()-new Date(p[2],p[1]-1,p[0]))/86400000)}
catch{return 0}
}
function calcXIRR(inv,cur,days){
if(inv<=0||days<=0)return 0;
return (Math.pow(cur/inv,365/days)-1)*100;
}

/* ===== DATA ===== */
function fetchData(){
Papa.parse(csvUrl,{
download:true,
error:()=>{
globalData=loadCache();
if(globalData.length)renderAll();
},
complete:res=>{
globalData=res.data.slice(1)
.filter(r=>r[0])
.map(r=>({
ad:r[0],tur:r[1],alisTarihi:r[2],
adet:clean(r[4]),aFiyat:clean(r[5]),
yatirim:clean(r[6]),fiyat:clean(r[7]),
tutar:clean(r[8]),gKZ:clean(r[9]),
hKZ:clean(r[10]),aKZ:clean(r[11]),
tKZ:clean(r[12])
}));
saveCache(globalData);
renderAll();
}
});
}

/* ===== RENDER ===== */
function renderAll(){
renderSummaries();
renderTicker();
renderMarketRows();
renderPerformance();
updateChart();
renderComment();
}

function renderComment(){
const t={g:0,a:0};
globalData.forEach(x=>{t.g+=x.gKZ;t.a+=x.aKZ});
document.getElementById("portfolioComment").innerText=
t.g>0&&t.a>0?"ðŸ“ˆ Momentum gÃ¼Ã§lÃ¼, korunabilir.":
t.g<0&&t.a>0?"ðŸ§  DÃ¼zeltme, panik yok.":
t.g<0&&t.a<0?"ðŸš¨ Trend zayÄ±f, risk azalt.":
"âš–ï¸ NÃ¶tr gÃ¶rÃ¼nÃ¼m.";
}

function renderSummaries(){
const totals={yat:0,tut:0,tKZ:0};
globalData.forEach(x=>{
totals.yat+=x.yatirim;
totals.tut+=x.tutar;
totals.tKZ+=x.tKZ;
});
document.getElementById("summaryGrid").innerHTML=`
<div class="card"><span>YatÄ±rÄ±m</span><div class="value">${totals.yat.toLocaleString()} â‚º</div></div>
<div class="card"><span>PortfÃ¶y</span><div class="value">${totals.tut.toLocaleString()} â‚º</div></div>
<div class="card"><span>Toplam K/Z</span><div class="value ${totals.tKZ>=0?'up':'down'}">${totals.tKZ.toLocaleString()} â‚º</div></div>
`;
}

function renderPerformance(){
const s=[...globalData].sort((a,b)=>b.gKZ-a.gKZ);
if(s.length){
bestPerf.querySelector('.up').innerText=s[0].ad;
worstPerf.querySelector('.down').innerText=s.at(-1).ad;
}
}

function updateChart(){
const g={};
globalData.forEach(x=>{
g[x.tur]=(g[x.tur]||0)+x.tutar;
});
const ctx=document.getElementById("allocationChart");
if(allocationChart)allocationChart.destroy();
allocationChart=new Chart(ctx,{
type:'doughnut',
data:{labels:Object.keys(g),datasets:[{data:Object.values(g)}]},
options:{plugins:{legend:{position:'right',labels:{color:'#94a3b8'}}}}
});
}

function renderTicker(){
const t=document.getElementById("tickerContent");
t.innerHTML=globalData.map(a=>{
let y=(a.gKZ/(a.tutar-a.gKZ))*100;
return `<div class="ticker-item">${a.ad} <span class="${y>=0?'up':'down'}">%${Math.abs(y).toFixed(2)}</span></div>`;
}).join('');
}

function renderMarketRows(){
document.getElementById("marketRows").innerHTML='';
}

function closeAll(){
document.getElementById("detailSection").style.display='none';
}

fetchData();
setInterval(fetchData,300000);
</script>
</body>
</html>
