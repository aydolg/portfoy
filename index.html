<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>PortfÃ¶y Terminali Pro Max</title>
<style>
:root{ --bg:#0b1220; --card:#111827; --line:#1f2937; --pos:#22c55e; --neg:#ef4444; --accent:#3b82f6; }
body{ margin:0; background:var(--bg); color:#e5e7eb; font-family:system-ui, -apple-system, sans-serif; overflow-x: hidden; }
h2{ margin:15px 16px 8px; font-size:11px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.6; }
/* Ticker */
.ticker-wrap { width: 100%; overflow: hidden; background: #1a2234; border-bottom: 2px solid var(--line); padding: 12px 0; display: flex; }
.ticker { display: flex; white-space: nowrap; animation: ticker-move 40s linear infinite; }
.ticker-item { display: flex; align-items: center; padding: 0 25px; font-size: 16px; font-weight: 800; border-right: 1px solid rgba(255,255,255,0.1); }
@keyframes ticker-move { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
/* ArayÃ¼z */
.header-section { position: sticky; top: 0; z-index: 100; background: rgba(11, 18, 32, 0.95); backdrop-filter: blur(15px); border-bottom: 1px solid var(--line); padding: 10px; }
.grid-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-bottom: 12px; }
.grid-types { display: grid; grid-template-columns: repeat(auto-fill, minmax(105px, 1fr)); gap: 8px; }
.grid-periods { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 10px; }
.card { background: linear-gradient(145deg, var(--card), #161e2e); border-radius: 12px; padding: 10px; border: 1px solid var(--line); display: flex; flex-direction: column; transition: 0.3s; }
.big { font-size: 14px; font-weight: 700; margin-top: 2px; }
.small { font-size: 8px; font-weight: 600; opacity: .5; text-transform: uppercase; }
.pos { color: var(--pos) } .neg { color: var(--neg) }
.type-card { cursor: pointer; opacity: 0.7; text-align: center; border: 1px solid var(--line); }
.type-card.active { border-color: var(--accent); opacity: 1; background: rgba(59, 130, 246, 0.15); box-shadow: 0 0 12px rgba(59,130,246,0.3); }
.detail-item { background: var(--card); border: 1px solid var(--line); border-radius: 10px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
.detail-info div:first-child { font-weight: 800; font-size: 13px; color: #fff; }
.detail-info div:last-child { font-size: 10px; opacity: 0.6; }
.detail-values { text-align: right; }
.detail-val { font-weight: 700; font-size: 13px; }
.detail-perc { font-size: 11px; font-weight: 600; }
#loader { position: fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:999; display:flex; justify-content:center; align-items:center; font-weight:bold; color:var(--accent); }
#search { width: 100%; padding: 8px; margin-bottom: 10px; background: var(--card); border: 1px solid var(--line); border-radius: 8px; color: #e5e7eb; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
<div id="loader">Veriler Analiz Ediliyor...</div>
<div class="ticker-wrap"><div class="ticker" id="ticker-content"></div></div>
<div id="app">
  <div class="header-section">
    <div class="grid-summary" id="summary"></div>
    <h2>ðŸ’¼ VarlÄ±k GruplarÄ±</h2>
    <div class="grid-types" id="types"></div>
  </div>
  <div class="content-section" style="padding: 0 10px;">
    <h2>ðŸ“ˆ DÃ¶nemsel Performans</h2>
    <div id="periods" class="grid-periods"></div>
    <h2 id="detail-title">ðŸ“¦ ÃœrÃ¼n DetaylarÄ±</h2>
    <input type="text" id="search" placeholder="ÃœrÃ¼n ara..." oninput="searchDetails()">
    <div id="detail-list"></div>
  </div>
</div>
<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQLPFVZn0j8Ygu914QDGRCGKsVy88gWjdk7DFi-jWiydmqYsdGUE4hEAb-R_IBzQmtFZwoMJFcN6rlD/pub?gid=1050165900&single=true&output=csv";
let DATA=[], ACTIVE="ALL";
// Ã‡ok daha gÃ¼Ã§lÃ¼ bir temizleyici
const cleanStr = (s) => s ? s.toString().trim().replace(/\s+/g, ' ') : "";
function toNumber(v){
    if (!v) return 0;
    let str = v.toString()
        .replace(/[^\d,\.-]/g, '')     // para birimi vs temizle
        .replace(/\./g, '')            // binlik noktasÄ±
        .replace(',', '.');            // ondalÄ±k virgÃ¼l â†’ nokta
    return parseFloat(str) || 0;
}
const formatTRY = v => v.toLocaleString('tr-TR', { maximumFractionDigits: 0 }) + " â‚º";
async function init() {
    try {
        const resp = await fetch(`${CSV_URL}&cachebuster=${Date.now()}`);
        const text = await resp.text();
        const parsed = Papa.parse(text.trim(), { header: true, skipEmptyLines: true, dynamicTyping: false });
        DATA = parsed.data.map(o => {
            for (let key in o) {
                if (key === "urun" || key === "tur") {
                    o[key] = cleanStr(o[key]);
                } else {
                    o[key] = toNumber(o[key]);
                }
            }
            return o;
        }).filter(item => item.urun !== "" && item.toplamYatirim > 0);
        if (DATA.length === 0) throw "Veri hatasÄ±";
        document.getElementById("loader").style.display = "none";
        renderAll();
    } catch (e) {
        setTimeout(init, 1000);
    }
}
const sum = (arr, key) => arr.reduce((a, b) => a + (b[key] ?? 0), 0);
function renderAll(){
    // Filtreleme yaparken "FON" ve "fon " gibi farklarÄ± ortadan kaldÄ±rÄ±yoruz
    const d = ACTIVE === "ALL" ? DATA : DATA.filter(x => cleanStr(x.tur).toUpperCase() === ACTIVE.toUpperCase());
   
    // Ã–zet panel
    const t = sum(d, "toplamYatirim"), g = sum(d, "guncelDeger"), kz = g - t;
    const p = t !== 0 ? ((kz / t) * 100).toFixed(1) : 0;
    document.getElementById("summary").innerHTML = `
        <div class="card" role="region" aria-label="Maliyet Ã¶zeti"><div class="small">Maliyet</div><div class="big">${formatTRY(t)}</div></div>
        <div class="card" role="region" aria-label="GÃ¼ncel deÄŸer Ã¶zeti"><div class="small">GÃ¼ncel</div><div class="big">${formatTRY(g)}</div></div>
        <div class="card ${kz>=0?"pos":"neg"}" role="region" aria-label="Toplam kar/zarar Ã¶zeti"><div class="small">Toplam K/Z</div><div class="big">${kz>=0?'+':''}${p}%</div><div style="font-size:9px; font-weight:bold">${formatTRY(kz)}</div></div>`;
    // TÃ¼r KartlarÄ± (VarlÄ±k GruplarÄ±)
    const turlar = [...new Set(DATA.map(item => cleanStr(item.tur)))].filter(Boolean);
    let typeHtml = `<div class="card type-card ${ACTIVE==="ALL"?"active":""}" onclick="setFilter('ALL')" role="button" aria-label="TÃ¼m varlÄ±klar"><div class="small">GENEL</div><div class="big" style="font-size:11px">HEPSÄ°</div></div>`;
    turlar.forEach(tur => {
        const sub = DATA.filter(x => cleanStr(x.tur) === tur);
        const subKz = sum(sub, "guncelDeger") - sum(sub, "toplamYatirim");
        typeHtml += `<div class="card type-card ${ACTIVE===tur?"active":""}" onclick="setFilter('${tur}')" role="button" aria-label="${tur} varlÄ±k grubu, kar/zarar ${formatTRY(subKz)}"><div class="small">${tur.toUpperCase()}</div><div class="big ${subKz>=0?'pos':'neg'}" style="font-size:11px">${formatTRY(subKz)}</div></div>`;
    });
    document.getElementById("types").innerHTML = typeHtml;
    // Periyotlar
    const periods = [["GÃ¼nlÃ¼k","gunluk"], ["HaftalÄ±k","haftalik"], ["AylÄ±k","aylik"], ["3 Ay","ucAylik"], ["6 Ay","altiAylik"], ["1 YÄ±l","birYillik"]];
    document.getElementById("periods").innerHTML = periods.map(x => {
        const v = sum(d, x[1]);
        const prevValue = sum(d, "guncelDeger") - v;
        const perc = prevValue !== 0 ? ((v / prevValue) * 100).toFixed(1) : 0;
        return `<div class="card ${v>=0?"pos":"neg"}" role="region" aria-label="${x[0]} performans"><div class="small">${x[0]}</div><div class="big">${formatTRY(v)} <span style="font-size:10px">(${v>=0?'+':''}${perc}%)</span></div></div>`;
    }).join("");
    // Alt ÃœrÃ¼n Listesi
    document.getElementById("detail-title").innerText = ACTIVE === "ALL" ? "ðŸ“¦ TÃœM ÃœRÃœNLER" : `ðŸ“¦ ${ACTIVE.toUpperCase()} DETAYLARI`;
    document.getElementById("detail-list").innerHTML = d.map(item => {
        const itemKz = item.guncelDeger - item.toplamYatirim;
        return `<div class="detail-item">
            <div class="detail-info"><div>${item.urun}</div><div>Maliyet: ${formatTRY(item.toplamYatirim)}</div></div>
            <div class="detail-values"><div class="detail-val">${formatTRY(item.guncelDeger)}</div><div class="detail-perc ${itemKz>=0?'pos':'neg'}">${formatTRY(itemKz)}</div></div>
        </div>`;
    }).join("");
    // Kayan Ticker
    const tickerItems = DATA.map(d => {
        const perc = (d.guncelDeger - d.gunluk) !== 0 ? ((d.gunluk / (d.guncelDeger - d.gunluk)) * 100).toFixed(2) : 0;
        return `<div class="ticker-item" style="color:${d.gunluk>=0?'var(--pos)':'var(--neg)'}">${d.urun} %${d.gunluk>=0?'+':''}${Math.abs(perc)}</div>`;
    }).join("");
    document.getElementById("ticker-content").innerHTML = tickerItems + tickerItems + tickerItems;
}
function setFilter(t) { ACTIVE = t; renderAll(); }
function searchDetails() {
    const val = document.getElementById("search").value.toLowerCase();
    const items = document.querySelectorAll(".detail-item");
    items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(val) ? "" : "none";
    });
}
init();
</script>
</body>
</html>



