<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lite PortfÃ¶y Terminali v2</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #0b1220;
      --card: #111a2e;
      --muted: #7f8db3;
      --accent: #4fd1c5;
      --danger: #f56565;
      --warning: #ecc94b;
      --ok: #48bb78;
      --text: #e6eaf5;
    }
    * { box-sizing: border-box; font-family: Inter, system-ui, sans-serif; }
    body { margin:0; background:var(--bg); color:var(--text); }
    h1 { font-size: 1.4rem; margin: 0; }
    h2 { font-size: 1rem; margin: 0 0 .5rem 0; color:var(--muted); }
    .container { padding: 20px; max-width: 1400px; margin:auto; }

    .grid { display:grid; grid-template-columns: 2fr 1fr; gap:20px; }
    .stack { display:grid; gap:20px; }

    .card {
      background: linear-gradient(180deg, #121c33, #0f172a);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    .summary { display:grid; grid-template-columns: repeat(4,1fr); gap:15px; }
    .metric {
      background: var(--card);
      border-radius: 14px;
      padding: 14px;
    }
    .metric .label { font-size:.8rem; color:var(--muted); }
    .metric .value { font-size:1.2rem; font-weight:600; margin-top:6px; }

    .value.positive { color: var(--ok); }
    .value.negative { color: var(--danger); }

    table { width:100%; border-collapse: collapse; }
    th, td { padding:10px; text-align:right; font-size:.85rem; }
    th { color:var(--muted); font-weight:500; }
    td:first-child, th:first-child { text-align:left; }
    tr:not(:last-child) td { border-bottom:1px solid rgba(255,255,255,.05); }

    .badge { padding:4px 10px; border-radius:20px; font-size:.75rem; }
    .ok { background:rgba(72,187,120,.15); color:var(--ok); }
    .warn { background:rgba(236,201,75,.15); color:var(--warning); }
    .bad { background:rgba(245,101,101,.15); color:var(--danger); }

    footer { text-align:center; color:var(--muted); font-size:.75rem; margin-top:20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“Š Lite PortfÃ¶y Terminali <span style="color:var(--muted)">v2</span></h1>

    <div class="summary" style="margin-top:20px">
      <div class="metric"><div class="label">Toplam PortfÃ¶y</div><div id="total" class="value">â€”</div></div>
      <div class="metric"><div class="label">GÃ¼nlÃ¼k DeÄŸiÅŸim</div><div id="daily" class="value">â€”</div></div>
      <div class="metric"><div class="label">Getiri (%)</div><div id="return" class="value">â€”</div></div>
      <div class="metric"><div class="label">Risk Modu</div><div id="risk" class="value">â€”</div></div>
    </div>

    <div class="grid" style="margin-top:20px">
      <div class="stack">
        <div class="card">
          <h2>PortfÃ¶y DaÄŸÄ±lÄ±mÄ±</h2>
          <table id="portfolioTable"></table>
        </div>
        <div class="card">
          <h2>PortfÃ¶y Zaman Serisi</h2>
          <canvas id="portfolioChart" height="120"></canvas>
        </div>
      </div>

      <div class="stack">
        <div class="card">
          <h2>Makro GÃ¶sterge Paneli</h2>
          <table id="macroTable"></table>
        </div>
      </div>
    </div>

    <footer>Veri kaynaÄŸÄ±: Google Sheets â€¢ YatÄ±rÄ±mcÄ± OdaklÄ± GÃ¶rÃ¼nÃ¼m</footer>
  </div>

<script>
/* ================= CONFIG ================= */
const PORTFOY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
const DATA_CSV    = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=2136415211&single=true&output=csv";
const MACRO_CSV   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=1018386005&single=true&output=csv";

/* ================= HELPERS ================= */
function csvToArray(text) {
  const lines = text.trim().split(/
?
/);
  const headers = lines.shift().split(',').map(h => h.trim());
  return lines.map(line => {
    const values = line.split(',');
    const obj = {};
    headers.forEach((h, i) => obj[h] = values[i]?.trim() || "");
    return obj;
  });
}

async function loadCSV(url, name) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(name + " yÃ¼klenemedi");
    const text = await res.text();
    return csvToArray(text);
  } catch (e) {
    console.error("CSV HATASI:", name, e);
    return [];
  }
}

function fmt(n) {
  if (isNaN(n)) return "â€”";
  return new Intl.NumberFormat('tr-TR', { maximumFractionDigits: 2 }).format(n);
}

/* ================= MAIN ================= */
(async () => {
  const portfolio = await loadCSV(PORTFOY_CSV, "PORTFOY");
  const data      = await loadCSV(DATA_CSV, "DATA");
  const macro     = await loadCSV(MACRO_CSV, "MACRO");

  /* ---- PORTFÃ–Y Ã–ZET ---- */
  let total = 0;
  portfolio.forEach(p => total += Number(p.Deger || p.DEGER || 0));
  document.getElementById('total').innerText = total ? fmt(total) + " â‚º" : "Veri yok";

  /* ---- GÃœNLÃœK GETÄ°RÄ° ---- */
  if (data.length >= 2) {
    const t = Number(data[data.length - 1].Toplam || data[data.length - 1].TOPLAM);
    const y = Number(data[data.length - 2].Toplam || data[data.length - 2].TOPLAM);
    const diff = t - y;
    const pct = y ? diff / y * 100 : 0;

    const dEl = document.getElementById('daily');
    dEl.innerText = (diff >= 0 ? '+' : '') + fmt(diff) + " â‚º";
    dEl.className = 'value ' + (diff >= 0 ? 'positive' : 'negative');

    document.getElementById('return').innerText = fmt(pct) + " %";
    document.getElementById('risk').innerHTML = pct > 1
      ? '<span class="badge ok">Risk AÃ§Ä±k</span>'
      : pct < -1
      ? '<span class="badge bad">Defansif</span>'
      : '<span class="badge warn">Dengeli</span>';
  } else {
    document.getElementById('daily').innerText = "Veri yok";
    document.getElementById('return').innerText = "â€”";
    document.getElementById('risk').innerText = "â€”";
  }

  /* ---- PORTFÃ–Y TABLO ---- */
  const pt = document.getElementById('portfolioTable');
  if (portfolio.length === 0) {
    pt.innerHTML = '<tr><td>PortfÃ¶y verisi bulunamadÄ±</td></tr>';
  } else {
    pt.innerHTML = '<tr><th>VarlÄ±k</th><th>DeÄŸer (â‚º)</th><th>AÄŸÄ±rlÄ±k</th></tr>' +
      portfolio.map(p => {
        const v = Number(p.Deger || p.DEGER || 0);
        return `<tr><td>${p.Varlik || p.VARLIK}</td><td>${fmt(v)}</td><td>${total ? fmt(v / total * 100) : '0'}%</td></tr>`;
      }).join('');
  }

  /* ---- ZAMAN SERÄ°SÄ° ---- */
  if (data.length > 0) {
    new Chart(document.getElementById('portfolioChart'), {
      type: 'line',
      data: {
        labels: data.map(d => d.Tarih || d.TARIH),
        datasets: [{ data: data.map(d => Number(d.Toplam || d.TOPLAM)), tension: .3 }]
      },
      options: { plugins: { legend: { display: false } }, scales: { x: { display: false } } }
    });
  }

  /* ---- MAKRO ---- */
  const mt = document.getElementById('macroTable');
  if (macro.length === 0) {
    mt.innerHTML = '<tr><td>Makro veri yok</td></tr>';
  } else {
    mt.innerHTML = macro.map(m => `<tr><td>${m.Gosterge || m.GOSTERGE}</td><td>${m.Deger || m.DEGER}</td></tr>`).join('');
  }
})();
</script>
</body>
</html>
