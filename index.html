<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PortfÃ¶y Dashboard</title>

<style>
:root{
  --bg:#0b1220;
  --card:#111827;
  --line:#1f2937;
  --pos:#22c55e;
  --neg:#ef4444;
}

body{
  margin:0;
  background:var(--bg);
  color:#e5e7eb;
  font-family:system-ui, Inter, Arial;
}

h2{
  margin:20px 0 12px;
  font-size:16px;
  font-weight:600;
}

.grid-3{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}
.grid-4{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:16px;
}

.card{
  background:linear-gradient(180deg,var(--card),#0e1627);
  border-radius:18px;
  padding:18px;
  box-shadow:0 10px 28px rgba(0,0,0,.45);
}

.big{font-size:22px;font-weight:700;margin-top:6px}
.small{font-size:13px;opacity:.65}

.pos{color:var(--pos)}
.neg{color:var(--neg)}

.type-card{
  cursor:pointer;
  border:2px solid transparent;
  transition:.25s;
}
.type-card:hover{transform:translateY(-3px)}
.type-card.active{
  border-color:var(--pos);
  box-shadow:0 0 0 2px rgba(34,197,94,.25);
}

/* STICKY */
.sticky{
  position:sticky;
  top:0;
  z-index:10;
  background:var(--bg);
  padding:16px;
  border-bottom:1px solid var(--line);
}

.wrapper{
  padding:20px;
  margin-top:360px; /* mobil iÃ§in kritik */
}
</style>
</head>

<body>

<div class="sticky">
  <div class="grid-3" id="summary"></div>

  <h2>ðŸ’¼ TÃ¼r BazlÄ± GÃ¼ncel DeÄŸer</h2>
  <div class="grid-4" id="types"></div>
</div>

<div class="wrapper">
  <h2>ðŸ“ˆ DÃ¶nemsel K/Z</h2>
  <div class="grid-3" id="periods"></div>
</div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQLPFVZn0j8Ygu914QDGRCGKsVy88gWjdk7DFi-jWiydmqYsdGUE4hEAb-R_IBzQmtFZwoMJFcN6rlD/pub?gid=1050165900&single=true&output=csv";

let DATA=[], ACTIVE="ALL";

/* GERÃ‡EK CSV PARSER */
function parseCSV(text){
  const rows=[];
  let row=[], cur="", inQuotes=false;

  for(let i=0;i<text.length;i++){
    const c=text[i];
    if(c === '"') inQuotes = !inQuotes;
    else if(c === "," && !inQuotes){
      row.push(cur); cur="";
    }
    else if(c === "\n" && !inQuotes){
      row.push(cur); rows.push(row);
      row=[]; cur="";
    }
    else cur+=c;
  }
  row.push(cur);
  rows.push(row);
  return rows;
}

/* SAYI NORMALÄ°ZASYONU */
function toNumber(v){
  if(v===undefined || v==="") return 0;
  return Number(
    v.replace(/\./g,"").replace(",",".")
  ) || 0;
}

fetch(CSV_URL)
.then(r=>r.text())
.then(t=>{
  const rows=parseCSV(t.trim());
  const headers=rows.shift();

  DATA=rows.map(r=>{
    let o={};
    headers.forEach((h,i)=>{
      if(h==="urun" || h==="tur") o[h]=r[i];
      else o[h]=toNumber(r[i]);
    });
    return o;
  });

  renderAll();
});

const sum=(arr,key)=>arr.reduce((a,b)=>a+(b[key]||0),0);
const filterTur=t=>t==="ALL"?DATA:DATA.filter(x=>x.tur===t);

function renderAll(){
  renderSummary();
  renderTypes();
  renderPeriods();
}

function renderSummary(){
  const t=sum(DATA,"toplamYatirim");
  const g=sum(DATA,"guncelDeger");
  const kz=g-t;

  document.getElementById("summary").innerHTML=`
    <div class="card">
      <div class="small">Toplam YatÄ±rÄ±m</div>
      <div class="big">${t.toLocaleString()}</div>
    </div>
    <div class="card">
      <div class="small">GÃ¼ncel DeÄŸer</div>
      <div class="big">${g.toLocaleString()}</div>
    </div>
    <div class="card ${kz>=0?"pos":"neg"}">
      <div class="small">Toplam K/Z</div>
      <div class="big">${kz.toLocaleString()}</div>
    </div>`;
}

function renderTypes(){
  const c=document.getElementById("types");
  c.innerHTML="";
  ["Hisse","Fon","Mevduat","Bono"].forEach(t=>{
    const v=sum(DATA.filter(x=>x.tur===t),"guncelDeger");
    c.innerHTML+=`
      <div class="card type-card ${ACTIVE===t?"active":""}"
           onclick="selectTur('${t}')">
        <div class="small">${t}</div>
        <div class="big">${v.toLocaleString()}</div>
      </div>`;
  });
}

function renderPeriods(){
  const d=filterTur(ACTIVE);
  const p=[
    ["GÃ¼nlÃ¼k","gunluk"],
    ["HaftalÄ±k","haftalik"],
    ["AylÄ±k","aylik"],
    ["3 AylÄ±k","ucAylik"],
    ["6 AylÄ±k","altiAylik"],
    ["1 YÄ±llÄ±k","birYillik"]
  ];

  document.getElementById("periods").innerHTML=
    p.map(x=>{
      const v=sum(d,x[1]);
      return `
      <div class="card ${v>=0?"pos":"neg"}">
        <div class="small">${x[0]} K/Z</div>
        <div class="big">${v.toLocaleString()}</div>
      </div>`;
    }).join("");
}

function selectTur(t){
  ACTIVE = (ACTIVE===t) ? "ALL" : t;
  renderTypes();
  renderPeriods();
}
</script>

</body>
</html>
