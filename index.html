<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PortfÃ¶y Takibi</title>
  <style>
    :root {
      --bg: #0f1117;
      --card: #1a1f2e;
      --text: #e2e8f0;
      --text-muted: #94a3b8;
      --border: #334155;
      --green: #22c55e;
      --red: #ef4444;
      --header: #111827;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px 15px;
      min-height: 100vh;
    }

    h2 {
      text-align: center;
      margin: 0 0 25px;
      color: white;
      font-weight: 600;
    }

    .controls {
      max-width: 1100px;
      margin: 0 auto 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      align-items: center;
    }

    .controls label {
      color: var(--text-muted);
      margin-right: 8px;
      font-size: 0.95rem;
    }

    select {
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.95rem;
      min-width: 180px;
    }

    table {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    th, td {
      padding: 14px 10px;
      text-align: right;
      border-bottom: 1px solid var(--border);
    }

    th {
      background: var(--header);
      color: white;
      font-weight: 600;
      text-align: center;
    }

    td:first-child, th:first-child { text-align: left; padding-left: 20px; }
    td:nth-child(2), th:nth-child(2) { text-align: center; }

    .kar { color: var(--green); font-weight: 600; }
    .zarar { color: var(--red); font-weight: 600; }

    tr:hover {
      background: #20263a;
    }

    .no-data {
      text-align: center;
      color: var(--text-muted);
      padding: 40px;
      font-size: 1.1rem;
    }

    @media (max-width: 768px) {
      table { font-size: 0.92rem; }
      th, td { padding: 10px 8px; }
    }
  </style>
</head>
<body>

  <h2>ðŸ“Š PortfÃ¶y Takibi</h2>

  <div class="controls">
    <label for="turFilter">TÃ¼r Filtresi:</label>
    <select id="turFilter">
      <option value="all">TÃ¼mÃ¼</option>
    </select>
  </div>

  <table id="portfoyTable">
    <thead>
      <tr>
        <th>VarlÄ±k</th>
        <th>TÃ¼r</th>
        <th>Adet</th>
        <th>AlÄ±ÅŸ FiyatÄ±</th>
        <th>Tutar</th>
        <th>GÃ¼nlÃ¼k %</th>
        <th>K/Z</th>
      </tr>
    </thead>
    <tbody id="tablo"></tbody>
  </table>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
    const tbody = document.getElementById("tablo");
    const filterSelect = document.getElementById("turFilter");
    let allRows = [];

    // TÃ¼rkÃ§e sayÄ± parse helper fonksiyonu
    function trParseFloat(str) {
      if (!str || typeof str !== 'string') return 0;
      // Binlik ayÄ±rÄ±cÄ± nokta, ondalÄ±k virgÃ¼l â†’ standart float'a Ã§evir
      const cleaned = str
        .replace(/\./g, '')           // binlik noktalarÄ± sil
        .replace(',', '.');           // virgÃ¼lÃ¼ noktaya Ã§evir
      return parseFloat(cleaned) || 0;
    }

    // TÃ¼rkÃ§e formatta gÃ¶sterim (1.234.567,89)
    function trFormatNumber(num, decimals = 0) {
      return num.toLocaleString('tr-TR', {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function renderTable(filter = "all") {
      tbody.innerHTML = "";
      const filtered = filter === "all" 
        ? allRows 
        : allRows.filter(row => row.tur === filter);

      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="no-data">SeÃ§ilen kritere uygun veri bulunamadÄ±</td></tr>';
        return;
      }

      filtered.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.ad}</td>
          <td>${row.tur}</td>
          <td>${trFormatNumber(row.adet)}</td>
          <td>${trFormatNumber(row.alisFiyati, 2)}</td>
          <td>${trFormatNumber(row.tutar)} â‚º</td>
          <td class="${row.gunluk >= 0 ? 'kar' : 'zarar'}">${row.gunlukText}</td>
          <td class="${row.kz >= 0 ? 'kar' : 'zarar'}">${row.kzText} â‚º</td>
        `;
        tbody.appendChild(tr);
      });
    }

    Papa.parse(csvUrl, {
      download: true,
      skipEmptyLines: true,
      complete: function(results) {
        const rows = results.data;

        if (rows.length < 3) {
          tbody.innerHTML = '<tr><td colspan="7" class="no-data">Veri formatÄ± beklenenden farklÄ±</td></tr>';
          return;
        }

        allRows = rows.slice(2)
          .filter(row => row && row.length >= 9 && row[0]?.trim())
          .map(row => {
            const ad         = row[0]?.trim() || '';
            const tur        = row[1]?.trim() || '';
            const adet       = trParseFloat(row[2]);
            const alisFiyati = trParseFloat(row[3]);
            const tutar      = trParseFloat(row[5]);
            const kzRaw      = row[6] || '';
            const gunlukRaw  = row[8] || '';

            const kz     = kzRaw.includes('#N/A') ? 0 : trParseFloat(kzRaw);
            const gunluk = gunlukRaw.includes('#N/A') ? 0 : trParseFloat(gunlukRaw.replace('%',''));

            return {
              ad,
              tur,
              adet,
              alisFiyati,
              tutar,
              kz,
              kzText: kzRaw.includes('#N/A') ? '#N/A' : trFormatNumber(kz),
              gunluk,
              gunlukText: gunlukRaw.includes('#N/A') ? '-' : gunluk.toFixed(2) + '%'
            };
          });

        // TÃ¼r filtre seÃ§eneklerini doldur
        const turSet = new Set(allRows.map(r => r.tur).filter(t => t));
        turSet.forEach(tur => {
          const opt = document.createElement("option");
          opt.value = tur;
          opt.textContent = tur;
          filterSelect.appendChild(opt);
        });

        renderTable();
      },
      error: function(error) {
        console.error("CSV HatasÄ±:", error);
        tbody.innerHTML = '<tr><td colspan="7" class="no-data">Veri yÃ¼klenemedi</td></tr>';
      }
    });

    filterSelect.addEventListener("change", (e) => {
      renderTable(e.target.value);
    });
  });
</script>
</body>
</html>

