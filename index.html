<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PortfÃ¶y Dashboard</title>

<style>
:root{
  --bg:#0b1220;
  --card:#111827;
  --pos:#22c55e;
  --neg:#ef4444;
}

body{
  margin:0;
  padding:20px;
  background:var(--bg);
  color:#e5e7eb;
  font-family:system-ui, Inter, Arial;
}

h2{
  margin:26px 0 14px;
  font-size:17px;
  font-weight:600;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}

.card{
  background:linear-gradient(180deg,var(--card),#0e1627);
  border-radius:18px;
  padding:20px;
  box-shadow:0 10px 26px rgba(0,0,0,.45);
}

.big{font-size:22px;font-weight:700;margin-top:6px}
.small{font-size:13px;opacity:.65}

.pos{color:var(--pos)}
.neg{color:var(--neg)}

.type-card{
  cursor:pointer;
  border:2px solid transparent;
}
.type-card.active{
  border-color:var(--pos);
}
</style>
</head>

<body>

<h2>ðŸ“Š Genel Ã–zet</h2>
<div class="grid" id="summary"></div>

<h2>ðŸ’¼ TÃ¼r BazlÄ± GÃ¼ncel DeÄŸer</h2>
<div class="grid" id="types"></div>

<h2>ðŸ“ˆ DÃ¶nemsel K/Z</h2>
<div class="grid" id="periods"></div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQLPFVZn0j8Ygu914QDGRCGKsVy88gWjdk7DFi-jWiydmqYsdGUE4hEAb-R_IBzQmtFZwoMJFcN6rlD/pub?gid=1050165900&single=true&output=csv";

let DATA=[], ACTIVE="ALL", MAP={};

/* CSV PARSER */
function parseCSV(text){
  const rows=[], re=/(?:^|,)(?:"([^"]*)"|([^",]*))/g;
  text.split("\n").forEach(line=>{
    let row=[], m;
    while(m=re.exec(line)) row.push(m[1]||m[2]||"");
    rows.push(row);
  });
  return rows;
}

function num(v){
  return Number(v.replace(/\./g,"").replace(",",".")) || 0;
}

fetch(CSV_URL).then(r=>r.text()).then(t=>{
  const rows=parseCSV(t.trim());
  const headers=rows.shift();

  console.log("CSV BAÅžLIKLAR:", headers);

  headers.forEach(h=>{
    const k=h.toLowerCase().replace(/[^a-z]/g,"");
    MAP[k]=h;
  });

  DATA=rows.map(r=>{
    let o={};
    headers.forEach((h,i)=>{
      const k=h.toLowerCase().replace(/[^a-z]/g,"");
      o[k]=(k==="urun"||k==="tur") ? r[i] : num(r[i]);
    });
    return o;
  });

  renderAll();
});

const sum=(a,k)=>a.reduce((x,y)=>x+(y[k]||0),0);
const filt=t=>t==="ALL"?DATA:DATA.filter(x=>x.tur===t);

function renderAll(){
  renderSummary();
  renderTypes();
  renderPeriods();
}

function renderSummary(){
  const t=sum(DATA,"toplamyatirim");
  const g=sum(DATA,"gunceldeger");
  const kz=g-t;

  summary.innerHTML=`
    <div class="card"><div class="small">Toplam YatÄ±rÄ±m</div><div class="big">${t.toLocaleString()}</div></div>
    <div class="card"><div class="small">GÃ¼ncel DeÄŸer</div><div class="big">${g.toLocaleString()}</div></div>
    <div class="card ${kz>=0?"pos":"neg"}"><div class="small">Toplam K/Z</div><div class="big">${kz.toLocaleString()}</div></div>
  `;
}

function renderTypes(){
  types.innerHTML="";
  ["Hisse","Fon","Mevduat","Bono"].forEach(t=>{
    const v=sum(DATA.filter(x=>x.tur===t),"gunceldeger");
    types.innerHTML+=`
      <div class="card type-card ${ACTIVE===t?"active":""}" onclick="selectTur('${t}')">
        <div class="small">${t}</div>
        <div class="big">${v.toLocaleString()}</div>
      </div>`;
  });
}

function renderPeriods(){
  const d=filt(ACTIVE);
  const periods=[
    ["GÃ¼nlÃ¼k","gunluk"],
    ["HaftalÄ±k","haftalik"],
    ["AylÄ±k","aylik"],
    ["3 AylÄ±k","aylik"],
    ["6 AylÄ±k","altiaylik"],
    ["1 YÄ±llÄ±k","yillik"]
  ];

  periodsDiv.innerHTML=periods.map(p=>{
    const v=sum(d,p[1]);
    return `<div class="card ${v>=0?"pos":"neg"}"><div class="small">${p[0]} K/Z</div><div class="big">${v.toLocaleString()}</div></div>`;
  }).join("");
}

function selectTur(t){
  ACTIVE = ACTIVE===t ? "ALL" : t;
  renderTypes();
  renderPeriods();
}

const summary=document.getElementById("summary");
const types=document.getElementById("types");
const periodsDiv=document.getElementById("periods");
</script>

</body>
</html>
