<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ultimate Portföy Paneli v1.0</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Inter;background:#05070c;color:#fff}
.container{max-width:1200px;margin:auto;padding:16px}
.header{font-size:1.1rem;font-weight:800;color:#00ff9d;margin-bottom:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
.card{background:#0e1420;border-radius:14px;padding:14px;border:1px solid rgba(255,255,255,.08)}
.label{font-size:.6rem;color:#94a3b8;font-weight:700;text-transform:uppercase}
.value{font-size:1.1rem;font-weight:800;margin-top:6px}
.up{color:#00ff9d}.down{color:#ff4d6d}
.section{margin-top:22px}
canvas{max-height:260px}
</style>
</head>
<body>
<div class="container">
  <div class="header">Ultimate Portföy Paneli v1.0</div>

  <div class="grid" id="summary"></div>

  <div class="section card">
    <div class="label">Portföy Dağılımı</div>
    <canvas id="distChart"></canvas>
  </div>

  <div class="section card">
    <div class="label">Makro Göstergeler</div>
    <div class="grid" id="macro"></div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const PORTFOY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
const MACRO_CSV   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=1018386005&single=true&output=csv";

/* ================= HELPERS ================= */
function parseCSV(text){
  return text.replace(/\r/g,'').trim().split('\n').map(r=>r.split(','));
}
function num(v){
  if(!v) return 0;
  return parseFloat(v.replace(/\./g,'').replace(',','.'))||0;
}

/* ================= LOAD ================= */
async function load(){
  const [pRes,mRes]=await Promise.all([fetch(PORTFOY_CSV),fetch(MACRO_CSV)]);
  const pCSV=parseCSV(await pRes.text());
  const mCSV=parseCSV(await mRes.text());

  const pHead=pCSV[0];
  const pData=pCSV.slice(1).map(r=>({
    ad:r[0],tur:r[1],tutar:num(r[8]),tkz:num(r[12])
  }));

  renderSummary(pData);
  renderChart(pData);
  renderMacro(mCSV);
}

/* ================= SUMMARY ================= */
function renderSummary(data){
  let toplam=data.reduce((a,b)=>a+b.tutar,0);
  let tkz=data.reduce((a,b)=>a+b.tkz,0);
  const reel=tkz>0? 'Enflasyon Üstü':'Enflasyon Altı';

  document.getElementById('summary').innerHTML=`
    <div class="card"><div class="label">Toplam Portföy</div><div class="value">${toplam.toLocaleString('tr-TR')} ₺</div></div>
    <div class="card"><div class="label">Toplam K/Z</div><div class="value ${tkz>=0?'up':'down'}">${tkz.toLocaleString('tr-TR')} ₺</div></div>
    <div class="card"><div class="label">Reel Getiri</div><div class="value">${reel}</div></div>`;
}

/* ================= CHART ================= */
function renderChart(data){
  const g={};
  data.forEach(d=>{g[d.tur]=(g[d.tur]||0)+d.tutar});
  new Chart(document.getElementById('distChart'),{
    type:'doughnut',
    data:{labels:Object.keys(g),datasets:[{data:Object.values(g)}]},
    options:{plugins:{legend:{labels:{color:'#94a3b8'}}}}
  });
}

/* ================= MACRO ================= */
function renderMacro(csv){
  const rows=csv.slice(1);
  document.getElementById('macro').innerHTML=rows.map(r=>`
    <div class="card"><div class="label">${r[0]}</div><div class="value">${r[1]}</div></div>
  `).join('');
}

load();
</script>
</body>
</html>
