<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Elite Portf√∂y Terminali</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { margin:0; font-family:Inter,system-ui; background:#05070c; color:#fff }
.container { max-width:1100px; margin:auto; padding:20px }
h1 { font-size:20px; margin-bottom:10px }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px }
.card {
  background:#0e1320; border:1px solid #1f2937;
  border-radius:14px; padding:14px
}
.label { font-size:11px; color:#94a3b8 }
.value { font-size:20px; font-weight:800 }
.up { color:#22c55e } .down { color:#ef4444 }
hr { border:0; border-top:1px solid #1f2937; margin:16px 0 }
canvas { max-height:260px }
</style>
</head>

<body>
<div class="container">
<h1>üìä Elite Portf√∂y Terminali</h1>

<div class="grid" id="summary"></div>

<hr>

<canvas id="distChart"></canvas>

<hr>

<h3>üåç Makro G√∂stergeler</h3>
<div class="grid" id="macro"></div>

</div>

<script>
/* ================= CONFIG ================= */
const PORTFOY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
const MACRO_CSV   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=1018386005&single=true&output=csv";

/* ================= HELPERS ================= */
function num(v){
  if(!v) return 0;
  return Number(
    String(v)
      .replaceAll("‚Ç∫","")
      .replaceAll(".","")
      .replaceAll(",",".")
      .trim()
  ) || 0;
}

async function loadCSV(url){
  const r = await fetch(url);
  const t = await r.text();
  const [head,...rows] = t.split("\n").map(x=>x.split(","));
  return rows.map(r=>{
    let o={};
    head.forEach((h,i)=>o[h.trim()]=r[i]);
    return o;
  });
}

/* ================= MAIN ================= */
(async ()=>{
  const portfoy = await loadCSV(PORTFOY_CSV);
  const macro   = await loadCSV(MACRO_CSV);

  let toplam = 0, kz = 0;
  let dist = {};

  portfoy.forEach(p=>{
    const t = num(p["G√ºncel Tutar"]);
    const k = num(p["Toplam K/Z"]);
    toplam += t; kz += k;
    const tur = p["T√ºr"] || "Diƒüer";
    dist[tur] = (dist[tur]||0) + t;
  });

  document.getElementById("summary").innerHTML = `
    <div class="card"><div class="label">Toplam Portf√∂y</div><div class="value">${toplam.toLocaleString()} ‚Ç∫</div></div>
    <div class="card"><div class="label">Toplam K/Z</div><div class="value ${kz>=0?'up':'down'}">${kz.toLocaleString()} ‚Ç∫</div></div>
  `;

  new Chart(document.getElementById("distChart"),{
    type:"doughnut",
    data:{
      labels:Object.keys(dist),
      datasets:[{ data:Object.values(dist) }]
    }
  });

  document.getElementById("macro").innerHTML =
    macro.map(m=>`
      <div class="card">
        <div class="label">${m["Ad"]}</div>
        <div class="value">${m["Deƒüer"]}</div>
      </div>`).join("");
})();
</script>
</body>
</html>
