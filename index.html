<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Elite PortfÃ¶y Terminali v3.2</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
:root{
--bg:#030508;--card:rgba(16,20,29,.95);
--accent:#00ff9d;--red:#ff3b5c;
--text:#fff;--muted:#94a3b8;--border:rgba(255,255,255,.1);
}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans';padding:12px}
.container{max-width:1200px;margin:auto}
.up{color:var(--accent)}.down{color:var(--red)}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px}
</style>
</head>

<body>
<div class="container">

<!-- ÃœST PERFORMANS -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px">
  <div class="card"><small class="up">GÃ¼nÃ¼n YÄ±ldÄ±zÄ±</small><div id="bestPerf">â€“</div></div>
  <div class="card"><small class="down">GÃ¼nÃ¼n ZayÄ±fÄ±</small><div id="worstPerf">â€“</div></div>
</div>

<!-- Ã–ZET -->
<div id="summary" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:15px"></div>

<!-- YORUM -->
<div class="card" id="commentBox" style="margin-bottom:15px;font-size:.8rem"></div>

<!-- GRAFÄ°K -->
<div class="card">
<canvas id="chart" height="200"></canvas>
</div>

</div>

<script>
const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
let data=[],chart;

const clean=v=>parseFloat((v||"0").toString().replace(/\./g,'').replace(',','.'))||0;

const daysBetween=d=>{
try{let p=d.split('.');return Math.floor((Date.now()-new Date(p[2],p[1]-1,p[0]))/86400000)}catch{return 0}
};

const XIRR=(inv,cur,day)=>day>0?(Math.pow(cur/inv,365/day)-1)*100:0;

const saveCache=d=>localStorage.setItem("elite_cache",JSON.stringify(d));
const loadCache=()=>JSON.parse(localStorage.getItem("elite_cache")||"[]");

function fetchData(){
Papa.parse(csvUrl,{
download:true,
error:()=>{data=loadCache();render()},
complete:r=>{
data=r.data.slice(1).filter(x=>x[0]).map(r=>({
ad:r[0],tur:r[1],tutar:clean(r[8]),
yatirim:clean(r[6]),gKZ:clean(r[9]),
aKZ:clean(r[11]),tKZ:clean(r[12]),
gun:daysBetween(r[2])
}));
saveCache(data);render();
}
});
}

function render(){
if(!data.length)return;

const t={yat:0,tut:0,g:0,a:0};
data.forEach(x=>{t.yat+=x.yatirim;t.tut+=x.tutar;t.g+=x.gKZ;t.a+=x.aKZ});

document.getElementById("summary").innerHTML=`
<div class="card">YatÄ±rÄ±m<br><b>${t.yat.toLocaleString()} â‚º</b></div>
<div class="card">PortfÃ¶y<br><b>${t.tut.toLocaleString()} â‚º</b></div>
<div class="card">Toplam K/Z<br><b class="${t.tut-t.yat>=0?'up':'down'}">${(t.tut-t.yat).toLocaleString()} â‚º</b></div>
`;

document.getElementById("commentBox").innerText=
t.g>0&&t.a>0?"ğŸ“ˆ Momentum gÃ¼Ã§lÃ¼, taÅŸÄ±nabilir.":
t.g<0&&t.a>0?"ğŸ§  DÃ¼zeltme, panik yok.":
t.g<0&&t.a<0?"ğŸš¨ Trend zayÄ±f, risk azalt.":"âš–ï¸ NÃ¶tr gÃ¶rÃ¼nÃ¼m.";

const sorted=[...data].sort((a,b)=>b.gKZ-a.gKZ);
document.getElementById("bestPerf").innerText=sorted[0].ad;
document.getElementById("worstPerf").innerText=sorted.at(-1).ad;

if(chart)chart.destroy();
chart=new Chart(document.getElementById("chart"),{
type:'doughnut',
data:{labels:data.map(x=>x.ad),datasets:[{data:data.map(x=>x.tutar)}]},
options:{plugins:{legend:{display:false}}}
});

// Risk alarm
const risky=data.filter(x=>x.tutar>0&&(x.gKZ/x.tutar)<-0.05);
if(risky.length) alert("âš ï¸ RÄ°SK:\n"+risky.map(x=>x.ad).join(", "));
}

fetchData();
setInterval(fetchData,300000);
</script>
</body>
</html
