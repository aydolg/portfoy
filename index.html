<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>YatÄ±rÄ±mcÄ± Paneli</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;background:#0b1220;color:#e5e7eb;font-family:Inter,Arial}
.container{max-width:1100px;margin:auto;padding:20px}
h1{margin-bottom:10px}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
.card{background:#111827;border-radius:14px;padding:16px}
.big{font-size:1.4rem;font-weight:700}
.up{color:#22c55e}
.down{color:#ef4444}
.muted{opacity:.7;font-size:.8rem}
hr{border:none;border-top:1px solid #1f2937;margin:14px 0}
</style>
</head>

<body>
<div class="container">
<h1>ðŸ“Š YatÄ±rÄ±mcÄ± Paneli</h1>
<div id="cards" class="cards"></div>
<canvas id="pie"></canvas>
</div>

<script>
const PORTFOY_CSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
const DATA_CSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=2136415211&single=true&output=csv";
const MACRO_CSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=1018386005&single=true&output=csv";

async function loadCSV(url){
  const txt=await fetch(url).then(r=>r.text());
  const rows=txt.trim().split("\n").map(r=>r.split(","));
  const h=rows.shift();
  return rows.map(r=>{
    const o={};
    h.forEach((k,i)=>o[k.trim()]=isNaN(r[i])?r[i]:Number(r[i]));
    return o;
  });
}

(async()=>{
  const portfoy=await loadCSV(PORTFOY_CSV);
  const macro=await loadCSV(MACRO_CSV);

  console.log("ðŸ“¦ PORTFÃ–Y:",portfoy);
  console.log("ðŸŒ MACRO:",macro);

  if(!portfoy.length){
    document.getElementById("cards").innerHTML="âŒ Veri yok";
    return;
  }

  const yatirim=portfoy.reduce((s,x)=>s+x.yatirim,0);
  const deger=portfoy.reduce((s,x)=>s+x.tutar,0);
  const kar=deger-yatirim;
  const karPct=kar/yatirim*100;

  const enflasyon=(macro.find(m=>m.ad==="ENFLASYON")||{}).fiyat||0;
  const reel=karPct-enflasyon;

  const cards=document.getElementById("cards");
  cards.innerHTML=`
    <div class="card"><div class="muted">Toplam YatÄ±rÄ±m</div><div class="big">${yatirim.toLocaleString()} â‚º</div></div>
    <div class="card"><div class="muted">GÃ¼ncel DeÄŸer</div><div class="big">${deger.toLocaleString()} â‚º</div></div>
    <div class="card"><div class="muted">Nominal Getiri</div><div class="big ${kar>=0?'up':'down'}">${karPct.toFixed(2)}%</div></div>
    <div class="card"><div class="muted">Reel Getiri</div><div class="big ${reel>=0?'up':'down'}">${reel.toFixed(2)}%</div>
    <div class="muted">${reel>=0?'ðŸŸ¢ Enflasyon ÃœstÃ¼':'ðŸ”´ Enflasyon AltÄ±'}</div></div>
  `;

  new Chart(document.getElementById("pie"),{
    type:"pie",
    data:{
      labels:portfoy.map(x=>x.ad),
      datasets:[{data:portfoy.map(x=>x.tutar)}]
    }
  });
})();
</script>
</body>
</html>
