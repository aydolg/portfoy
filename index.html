<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PortfÃ¶y Dashboard</title>

<style>
body { font-family: Arial; background:#0f172a; color:#fff; margin:0; padding:20px }
h2 { margin-top:30px }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:15px; margin-bottom:25px }
.card { background:#111827; padding:15px; border-radius:12px }
.pos { color:#22c55e } .neg { color:#ef4444 }
select { padding:8px 12px; border-radius:8px; margin-bottom:20px }
</style>
</head>

<body>

<h2>ðŸ“Š Genel Durum</h2>
<div class="grid" id="topCards"></div>

<h2>ðŸ”Ž TÃ¼r SeÃ§imi</h2>
<select id="turFilter">
  <option value="ALL">TÃ¼mÃ¼</option>
  <option value="Hisse">Hisse</option>
  <option value="Fon">Fon</option>
  <option value="Mevduat">Mevduat</option>
  <option value="Bono">Bono</option>
</select>

<h2>ðŸ“ˆ DÃ¶nemsel K/Z</h2>
<div class="grid" id="periodCards"></div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQLPFVZn0j8Ygu914QDGRCGKsVy88gWjdk7DFi-jWiydmqYsdGUE4hEAb-R_IBzQmtFZwoMJFcN6rlD/pub?gid=1050165900&single=true&output=csv";

let ALL_DATA = [];

fetch(CSV_URL)
.then(r=>r.text())
.then(t=>{
  const [h,...rows]=t.trim().split("\n");
  const headers=h.split(",");
  ALL_DATA=rows.map(r=>{
    const v=r.split(",");
    let o={};
    headers.forEach((k,i)=>o[k]=isNaN(v[i])?v[i]:Number(v[i]));
    return o;
  });
  render("ALL");
});

document.getElementById("turFilter").onchange=e=>render(e.target.value);

function sum(d,k){return d.reduce((a,b)=>a+(b[k]||0),0)}

function render(tur){
  const d = tur==="ALL"?ALL_DATA:ALL_DATA.filter(x=>x.tur===tur);

  document.getElementById("topCards").innerHTML = `
    <div class="card">Toplam YatÄ±rÄ±m<br><b>${sum(d,"toplamYatirim").toLocaleString()}</b></div>
    <div class="card">GÃ¼ncel DeÄŸer<br><b>${sum(d,"guncelDeger").toLocaleString()}</b></div>
    <div class="card ${(sum(d,"guncelDeger")-sum(d,"toplamYatirim"))>=0?"pos":"neg"}">
      Toplam K/Z<br>
      <b>${(sum(d,"guncelDeger")-sum(d,"toplamYatirim")).toLocaleString()}</b>
    </div>
  `;

  document.getElementById("periodCards").innerHTML = `
    ${card("GÃ¼nlÃ¼k",sum(d,"gunluk"))}
    ${card("HaftalÄ±k",sum(d,"haftalik"))}
    ${card("AylÄ±k",sum(d,"aylik"))}
    ${card("3 AylÄ±k",sum(d,"ucAylik"))}
    ${card("6 AylÄ±k",sum(d,"altiAylik"))}
    ${card("1 YÄ±llÄ±k",sum(d,"birYillik"))}
  `;
}

function card(t,v){
  return `<div class="card ${v>=0?"pos":"neg"}">${t} K/Z<br><b>${v.toLocaleString()}</b></div>`;
}
</script>

</body>
</html>
