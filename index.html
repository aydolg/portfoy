<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YatÄ±rÄ±mcÄ± PortfÃ¶y Paneli</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg:#020617;--card:#0f172a;--border:#1e293b;
      --text:#e5e7eb;--muted:#94a3b8;
      --up:#22c55e;--down:#ef4444;--accent:#38bdf8;
    }
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,sans-serif}
    .wrap{max-width:1200px;margin:auto;padding:16px}
    h1{font-size:1.2rem;margin:0 0 12px 0}
    .grid{display:grid;gap:12px}
    .cards{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px}
    .lbl{font-size:.65rem;color:var(--muted);font-weight:700;text-transform:uppercase}
    .val{font-size:1.1rem;font-weight:800;margin-top:4px}
    .sub{font-size:.7rem;color:var(--muted);margin-top:4px}
    .up{color:var(--up)} .down{color:var(--down)}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.65rem;font-weight:800;margin-top:6px}
    .badge.up{background:rgba(34,197,94,.15)}
    .badge.down{background:rgba(239,68,68,.15)}
    .panel{margin-top:16px}
    canvas{max-height:260px}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ðŸ“Š YatÄ±rÄ±mcÄ± PortfÃ¶y Paneli</h1>

  <!-- Ã–ZET KARTLAR -->
  <div class="grid cards" id="summary"></div>

  <!-- GRAFÄ°K -->
  <div class="panel card">
    <div class="lbl">PortfÃ¶y DeÄŸeri (Zaman)</div>
    <canvas id="trendChart"></canvas>
  </div>

  <!-- MAKRO -->
  <div class="panel card">
    <div class="lbl">Makro GÃ¶stergeler</div>
    <div class="grid cards" id="macro"></div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const PORTFOY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
const DATA_CSV    = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=2136415211&single=true&output=csv";
const MACRO_CSV   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=1018386005&single=true&output=csv";

/* ================= HELPERS ================= */
const clean=v=>parseFloat((v||'').toString().replace(/\./g,'').replace(',','.').replace(/[^0-9.-]/g,''))||0;
const pDate=s=>{if(!s) return null;let p=s.split('.');if(p.length!==3) return null;return new Date(p[2],p[1]-1,p[0])};
const fetchCSV=url=>new Promise(res=>Papa.parse(url,{download:true,complete:r=>res(r.data.slice(1).filter(x=>x.length))}));

(async function init(){
  const [pRows,dRows,mRows]=await Promise.all([fetchCSV(PORTFOY_CSV),fetchCSV(DATA_CSV),fetchCSV(MACRO_CSV)]);
  renderSummary(pRows,dRows,mRows);
  renderChart(dRows);
  renderMacro(mRows);
})();

/* ================= SUMMARY ================= */
function renderSummary(pRows,dRows,mRows){
  const sumBox=document.getElementById('summary');
  const total=pRows.reduce((a,r)=>a+clean(r[8]),0);

  const series=dRows.map(r=>({d:pDate(r[0]),v:clean(r[1])})).filter(x=>x.d).sort((a,b)=>a.d-b.d);
  let daily='â€“', cls='';
  if(series.length>1){
    const l=series.at(-1), p=series.at(-2);
    const diff=l.v-p.v;
    cls=diff>=0?'up':'down';
    daily=`${diff>=0?'â–²':'â–¼'} ${diff.toLocaleString('tr-TR')} â‚º`;
  }

  const enfRow=mRows.find(r=>r[0]==='ENFLASYON_Y');
  const enf=enfRow?clean(enfRow[1]):0;
  const annual=series.length>30?((series.at(-1).v/series.at(0).v-1)*100):0;
  const real=annual-enf;

  sumBox.innerHTML=`
    <div class="card"><div class="lbl">Toplam PortfÃ¶y</div><div class="val">${total.toLocaleString('tr-TR')} â‚º</div></div>
    <div class="card"><div class="lbl">GÃ¼nlÃ¼k DeÄŸiÅŸim</div><div class="val ${cls}">${daily}</div></div>
    <div class="card"><div class="lbl">Reel Getiri</div><div class="val ${real>=0?'up':'down'}">%${real.toFixed(1)}</div>
      <div class="badge ${real>=0?'up':'down'}">${real>=0?'Enflasyon ÃœstÃ¼':'Enflasyon AltÄ±'}</div>
    </div>`;
}

/* ================= CHART ================= */
function renderChart(rows){
  const ctx=document.getElementById('trendChart');
  const data=rows.map(r=>({d:pDate(r[0]),v:clean(r[1])})).filter(x=>x.d).sort((a,b)=>a.d-b.d);
  new Chart(ctx,{type:'line',data:{labels:data.map(x=>x.d.toLocaleDateString('tr-TR')),datasets:[{data:data.map(x=>x.v),borderWidth:2}]},options:{plugins:{legend:{display:false}}}});
}

/* ================= MACRO ================= */
function renderMacro(rows){
  const box=document.getElementById('macro');
  box.innerHTML=rows.map(r=>`<div class="card"><div class="lbl">${r[0]}</div><div class="val">${r[1]}</div></div>`).join('');
}
</script>
</body>
</html>
